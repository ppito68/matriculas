SELECT au.Aula, fm.numero, CONCAT(fm.apellidos, ', ' , fm.nombre) as nombre, fm.curso, fm.horario, fm.dias, 
	(select count(numeroAlumno) from stControlAsistencia c 
     	where c.fecha <= '20200914' and  c.modoAsistencia = 'a' and c.numeroAlumno = fm.numero) as asiste, 
	(select count(numeroAlumno) from stControlAsistencia c 
     	where c.fecha <= '20200914' and  c.modoAsistencia = 'o' and c.numeroAlumno = fm.numero) as remoto, 
    ( SELECT modoAsistencia FROM stControlAsistencia c WHERE c.numeroAlumno = fm.numero AND c.fecha = '2020-09-07') AS '2020-09-07',
    ( SELECT modoAsistencia FROM stControlAsistencia c WHERE c.numeroAlumno = fm.numero AND c.fecha = '2020-09-14') AS '2020-09-14' 
FROM stFM2021 fm 
	INNER JOIN ssAulas au ON au.id = fm.idAula 
    LEFT JOIN stControlAsistencia cont ON cont.numeroAlumno = fm.numero and cont.fecha <= '20200914' 
WHERE 1 = 1 AND idCentro = 1 AND idAula = 1 AND fm.dias = 'M-W' 
GROUP BY au.Aula, fm.numero, fm.nombre, fm.apellidos, fm.curso, fm.horario, fm.dias 
ORDER BY fm.horario, idAula, remoto, fm.numero desc





// aforo


select fm.centro, fm.idAula, fm.dias, fm.horario, fm.curso, count(numero) AS matriculados,
if(count(fm.numero) > au.aforoCovid, au.plazas % au.aforoCovid, 0) AS online,
count(fm.numero) - if(count(fm.numero) > au.aforoCovid, au.plazas % au.aforoCovid ,0) AS Asisten 
from stFM2021 fm
      inner join ssAulas as au ON au.Id = fm.idAula
group by fm.centro, fm.idAula, fm.dias, fm.horario, fm.curso


//
SELECT au.Aula, fm.numero, CONCAT(fm.apellidos, ', ' , fm.nombre) as nombre, fm.curso, fm.horario, fm.dias, 
	(select count(numeroAlumno) from stControlAsistencia c 
     	where c.fecha <= '20200914' and  c.modoAsistencia = 'a' and c.numeroAlumno = fm.numero) as asiste, 
	(select count(numeroAlumno) from stControlAsistencia c 
     	where c.fecha <= '20200914' and  c.modoAsistencia = 'o' and c.numeroAlumno = fm.numero) as remoto, 
    ( SELECT modoAsistencia FROM stControlAsistencia c WHERE c.numeroAlumno = fm.numero AND c.fecha = '2020-09-14') AS '2020-09-14' 
FROM stFM2021 fm 
	INNER JOIN ssAulas au ON au.id = fm.idAula 
WHERE 1 = 1 AND idCentro = 1 AND idAula = 1 AND fm.dias = 'M-W' 
GROUP BY au.Aula, fm.numero, fm.nombre, fm.apellidos, fm.curso, fm.horario, fm.dias 
ORDER BY fm.horario, idAula, remoto, fm.numero desc